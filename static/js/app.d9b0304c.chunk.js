(this.webpackJsonp=this.webpackJsonp||[]).push([[1],{285:function(e,t,n){n(286),e.exports=n(421)},286:function(e,t){"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/dionysos-legacy/expo-service-worker.js",{scope:"/dionysos-legacy/"}).then((function(e){})).catch((function(e){console.info("Failed to register service-worker",e)}))}))},40:function(e,t,n){"use strict";var a=n(164);n.d(t,"c",(function(){return a.a}));var r=n(25);n.d(t,"b",(function(){return r.a})),n.d(t,"a",(function(){return a.b})),n.d(t,"d",(function(){return r.c})),n.d(t,"e",(function(){return r.f})),n.d(t,"g",(function(){return r.h})),n.d(t,"f",(function(){return r.g}))},414:function(e,t,n){"use strict";n.r(t),n.d(t,"wines",(function(){return a}));var a=[{PartitionKey:"1",RowKey:"1",Timestamp:1595059246710,date:1595059246710,rating:5,color:"red",sweetness:"dry"},{PartitionKey:"1",RowKey:"2",Timestamp:1595059246710,date:1595059246710,rating:5,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"3",Timestamp:1595059246710,date:1595059246710,rating:6,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"4",Timestamp:1595059246710,date:1595059246710,rating:5,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"5",Timestamp:1595059246710,date:1595059246710,rating:5,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"6",Timestamp:1595059246710,date:1595059246710,rating:5,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"7",Timestamp:1595059246710,date:1595059246710,rating:5,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"8",Timestamp:1595059246710,date:1595059246710,rating:5,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"9",Timestamp:1595059246710,date:1595059246710,rating:5,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"10",Timestamp:1595059246710,date:1595059246710,rating:5,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"11",Timestamp:1595059246710,date:1595059246710,rating:5,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"12",Timestamp:1595059246710,date:1595059246710,rating:5,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"13",Timestamp:1595059246710,date:1595059246710,rating:5,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"14",Timestamp:1595059246710,date:1595059246710,rating:5,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"15",Timestamp:1595059246710,date:1595059246710,rating:5,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"16",Timestamp:1595059246710,date:1595059246710,rating:7,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"17",Timestamp:1595059246710,date:1595059246710,rating:4,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"18",Timestamp:1595059246710,date:1595059246710,rating:7,color:"white",sweetness:"medium sweet"},{PartitionKey:"1",RowKey:"19",Timestamp:1595059246710,date:1595059246710,rating:7,color:"white",sweetness:"medium sweet"}].reduce((function(e,t){return e[t.RowKey]=t,e}),{})},421:function(e,t,n){"use strict";n.r(t);var a=n(435),r=n(1),i=n.n(r),s=n(2),o=n(3),c=n(63),u=n(91),l=n(64),w=n.n(l);function m(){var e=Object(r.useState)(""),t=w()(e,2),n=t[0],a=t[1],s=Object(r.useState)(""),l=w()(s,2),m=l[0],p=l[1],f=Object(r.useState)(!1),h=w()(f,2),y=h[0],g=h[1],b=Object(r.useState)(""),v=w()(b,2),K=v[0],P=v[1],x=Object(r.useContext)(u.a).login,E=Object(r.useCallback)((function(){g(!0)}),[g]);return Object(r.useEffect)((function(){y&&x(n,m).catch((function(e){P(e.message),g(!1)}))}),[y]),i.a.createElement(o.a,{style:d.container},i.a.createElement(c.e,{label:"Username",placeholder:"Username",onChangeText:a,disabled:y,errorMessage:K}),i.a.createElement(c.e,{label:"Password",placeholder:"Password",secureTextEntry:!0,onChangeText:p,disabled:y,errorMessage:K}),i.a.createElement(c.a,{title:"Login",onPress:E,containerStyle:{width:"90%"},disabled:y||!n||!m}))}var d=s.a.create({container:{maxWidth:360,flex:1,backgroundColor:"#fff",alignItems:"center",justifyContent:"center"}}),p=n(40),f=n(8),h=n(148),y=[{label:"Home",value:"/"},{label:"View wines",value:"/wine-overview"},{label:"Add a wine",value:"/edit-wine/-1"}];function g(){var e,t=Object(p.f)(),n=Object(p.e)();return i.a.createElement(h.a,{style:{height:49,width:150},mode:"dropdown",selectedValue:(e=t.pathname,"/wine-overview"===e?"/wine-overview":e.startsWith("/edit-wine")?"/edit-wine/-1":"/home"),onValueChange:function(e){var a,r,i;a=t.pathname,r=e,i=n.push,a.split("/")[1]!==r.split("/")[1]&&i(r)}},y.map((function(e){return i.a.createElement(h.a.Item,{key:e.value,label:e.label,value:e.value})})))}function b(){return i.a.createElement(c.c,{containerStyle:{height:"ios"===f.a.OS?75:50,backgroundColor:"#3D6DCC",marginBottom:16},rightComponent:i.a.createElement(g,null)})}var v=n(22),K=n(276);function P(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(K.a,{name:"glass-cheers",size:32,color:"red"}),i.a.createElement(o.a,{style:E.link},i.a.createElement(p.a,{to:"/wine-overview"},i.a.createElement(v.a,null,"View wines"))),i.a.createElement(o.a,{style:E.link},i.a.createElement(p.a,{to:"/edit-wine/-1"},i.a.createElement(v.a,null,"Add a wine"))))}var x,E=s.a.create({link:{borderWidth:2,borderStyle:"solid",borderColor:"blue",padding:8,marginTop:8}}),O=(x=function(){return i.a.createElement(o.a,{style:j.appView},i.a.createElement(i.a.Suspense,{fallback:i.a.createElement(c.g,null,"Loading...")},i.a.createElement(b,null),i.a.createElement(o.a,{style:j.container},i.a.createElement(p.d,null,i.a.createElement(p.b,{path:"/wine-overview",component:i.a.lazy((function(){return Promise.all([n.e(0),n.e(6)]).then(n.bind(null,508))}))}),i.a.createElement(p.b,{path:"/edit-wine/:RowKey",component:i.a.lazy((function(){return Promise.all([n.e(0),n.e(4),n.e(5)]).then(n.bind(null,507))}))}),i.a.createElement(p.b,{component:P})))))},function(){return i.a.createElement(p.c,null,i.a.createElement(u.b,null,i.a.createElement(u.a.Consumer,null,(function(e){return e.isLoggedIn?i.a.createElement(x,null):i.a.createElement(m,null)}))))}),j=s.a.create({appView:{flex:1,alignSelf:"stretch",backgroundColor:"#fff"},container:{flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center"}});Object(a.a)(O)},91:function(e,t,n){"use strict";n.d(t,"a",(function(){return v})),n.d(t,"b",(function(){return K}));var a=n(7),r=n.n(a),i=n(14),s=n.n(i),o=n(64),c=n.n(o),u=n(1),l=n.n(u),w=n(40),m=n(12),d=n.n(m),p=n(13),f=n.n(p),h=function(){function e(t,n,a,r,i){d()(this,e),this.tableHost=t,this.tableSas=n,this.imageHost=a,this.imageSas=r,this.logout=i}return f()(e,[{key:"getWines",value:function(){var e,t,n,a;return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s.a.awrap(fetch(this.tableHost+"wines?"+this.tableSas,{headers:{Accept:"application/json;odata=nometadata"}}));case 2:if(200===(e=r.sent).status){r.next=10;break}return this.logout(),r.t0=Error,r.next=8,s.a.awrap(e.text());case 8:throw r.t1=r.sent,new r.t0(r.t1);case 10:return r.next=12,s.a.awrap(e.json());case 12:return t=r.sent,n=t.value,a=n,r.abrupt("return",a.reduce((function(e,t){return e[t.RowKey]=t,e}),{}));case 16:case"end":return r.stop()}}),null,this,null,Promise)}},{key:"upsert",value:function(e,t){var n;return s.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.PartitionKey="1","-1"===e.RowKey&&(e.RowKey=String((new Date).getTime())),!e.image||e.image===t.image){a.next=6;break}return a.next=5,s.a.awrap(this.uploadImage(e.RowKey,e.image));case 5:e.image=e.RowKey;case 6:return a.next=8,s.a.awrap(fetch(this.tableHost+"wines(PartitionKey='"+e.PartitionKey+"',RowKey='"+e.RowKey+"')?"+this.tableSas,{method:"MERGE",headers:{Accept:"application/json;odata=nometadata","Access-Control-Allow-Origin":this.tableHost,"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)}));case 8:if(204===(n=a.sent).status){a.next=16;break}return this.logout(),a.t0=Error,a.next=14,s.a.awrap(n.text());case 14:throw a.t1=a.sent,new a.t0(a.t1);case 16:return a.abrupt("return",e);case 17:case"end":return a.stop()}}),null,this,null,Promise)}},{key:"downloadImage",value:function(e){var t,n;return s.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.a.awrap(fetch(this.imageHost+"/"+e+"?"+this.imageSas));case 2:if(200===(t=a.sent).status){a.next=5;break}return a.abrupt("return","");case 5:return a.next=7,s.a.awrap(t.blob());case 7:return n=a.sent,a.abrupt("return",new Promise((function(e){var t=new FileReader;t.onloadend=function(){e(t.result)},t.readAsDataURL(n)})));case 9:case"end":return a.stop()}}),null,this,null,Promise)}},{key:"uploadImage",value:function(e,t){var n;return s.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=s.a,a.next=3,s.a.awrap(fetch(t));case 3:return a.t1=a.sent.blob(),a.next=6,a.t0.awrap.call(a.t0,a.t1);case 6:return n=a.sent,a.abrupt("return",fetch(this.imageHost+"/"+e+"?"+this.imageSas,{method:"PUT",headers:{"Content-Length":String(n.size),"x-ms-blob-type":"BlockBlob"},body:n}));case 8:case"end":return a.stop()}}),null,this,null,Promise)}}],[{key:"login",value:function(t,n,a){var r,i,o,c;return s.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,s.a.awrap(fetch("https://dionysos-waiter.azurewebsites.net/api/login",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({username:t,pw:n})}));case 2:if(200===(r=u.sent).status){u.next=9;break}return u.t0=Error,u.next=7,s.a.awrap(r.text());case 7:throw u.t1=u.sent,new u.t0(u.t1);case 9:return u.next=11,s.a.awrap(r.json());case 11:return i=u.sent,o=i.imageBlobCredentials,c=i.wineTableCredentials,u.abrupt("return",new e(c.host,c.sas,o.host,o.sas,a));case 15:case"end":return u.stop()}}),null,null,null,Promise)}}]),e}();function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b={isLoggedIn:!1,login:function(){return Promise.resolve()},manager:null,wines:{},getWines:function(){},upsertWine:function(e,t){return Promise.resolve(e)}},v=l.a.createContext(b);function K(e){var t=Object(w.e)(),n=Object(u.useState)(b.manager),a=c()(n,2),i=a[0],o=a[1],m=Object(u.useState)(b.wines),d=c()(m,2),p=d[0],f=d[1],y=Object(u.useCallback)((function(){o(null)}),[o]),K=Object(u.useCallback)((function(e,t){var n;return s.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.a.awrap(h.login(e,t,y));case 2:return n=a.sent,o(n),a.t0=f,a.next=7,s.a.awrap(n.getWines());case 7:a.t1=a.sent,(0,a.t0)(a.t1);case 9:case"end":return a.stop()}}),null,null,null,Promise)}),[o,f]),P=Object(u.useCallback)((function(){var e;return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=f,t.next=3,s.a.awrap(null==i?void 0:i.getWines());case 3:if(t.t1=e=t.sent,null==t.t1){t.next=8;break}t.t2=e,t.next=9;break;case 8:t.t2={};case 9:t.t3=t.t2,(0,t.t0)(t.t3);case 11:case"end":return t.stop()}}),null,null,null,Promise)}),[i,f]),x=Object(u.useCallback)((function(e,n){return s.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.a.awrap(i.upsert(e,n));case 2:return e=a.sent,f(g(g({},p),{},r()({},e.RowKey,e))),t.push("/wine-overview"),a.abrupt("return",e);case 6:case"end":return a.stop()}}),null,null,null,Promise)}),[i,f,p,t]);return l.a.createElement(v.Provider,{value:{isLoggedIn:null!==i,login:K,manager:i,wines:p,getWines:P,upsertWine:x}},e.children)}}},[[285,2,3]]]);
//# sourceMappingURL=app.d9b0304c.chunk.js.map